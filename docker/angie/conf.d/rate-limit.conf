# =============================================================================
# Rate Limiting Configuration
# =============================================================================
# Equivalent to Traefik's 100 req/s average, 50 burst
#
# Zones:
#   - api_limit: For API endpoints (100 req/s, burst 50)
#   - general_limit: For general requests (50 req/s, burst 25)
#   - conn_limit: Connection limiting per IP
# =============================================================================

# Rate limit zones (stored in shared memory)
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=100r/s;
limit_req_zone $binary_remote_addr zone=general_limit:10m rate=50r/s;
limit_req_zone $binary_remote_addr zone=auth_limit:10m rate=10r/s;

# Connection limits per IP
limit_conn_zone $binary_remote_addr zone=conn_limit:10m;

# Rate limit response codes
limit_req_status 429;
limit_conn_status 429;

# Log rate limiting (optional, can be noisy)
# limit_req_log_level warn;
# limit_conn_log_level warn;

# =============================================================================
# Usage in location blocks:
# =============================================================================
# limit_req zone=api_limit burst=50 nodelay;
# limit_conn conn_limit 100;
# =============================================================================
